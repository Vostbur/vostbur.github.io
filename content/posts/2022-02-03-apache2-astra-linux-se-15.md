---
categories:
- OS
date: "2022-02-03"
description: Настройка web-сервера на Astra Linux SE 1.5
slug: apache2-astra-linux-se-15
tags:
- linux
- web-server
- apache2
- AstraLinux
title: Настройка web-сервера на Astra Linux SE 1.5
---

Web-сервер Apache2, входящий в состав Astra Linux SE 1.5 Smolensk, не допускает возможности анонимного использования ресурсов web-сервера и требует обязательной настройки авторизации пользователей.

Для обеспечения нормальной работы пользователя с сетевыми сервисами должны быть явно заданы диапазоны его мандатных уровней и категорий, даже если ему не доступны уровни и категории выше 0. 

    # pdpl-user -z <имя_пользователя>

После установки сервера необходимо установить пакет `libapache2-mod-auth-pam`. После этого сервер настроен и готов к приему запросов на всех сетевых интерфейсах на 80 порту. Если по каким-то причинам он не работоспособен, следует проверить минимально необходимые настройки сервера.

В файле `/etc/apache2/ports.conf` должны быть указаны параметры:

    NameVirtualHost *:80
    Listen 80

В каталоге `/etc/apache2/sites-available` должны находиться файлы с настройками виртуальных хостов и как минимум один из них должен быть разрешен к использованию командой:

    # a2ensite config_filename

В команде необходимо использовать только имя файла (без указания полного пути).

Минимальное содержимое таких файлов с конфигурациями виртуальных хостов выглядит следующим образом __(пример для аутентификации через PAM)__:

    <VirtualHost *:80>
        ServerAdmin webmaster@localhost
        ServerName server.domain.name

        AuthPAM_Enabled on
        AuthType Basic
        AuthName "PAM authentication"
        require valid-user

        DocumentRoot /var/www/
        <Directory /var/www/>
            Options Indexes FollowSymLinks MultiViews AllowOverride None
        </Directory>

        ErrorLog /var/log/apache2/error.log
        LogLevel warn
        CustomLog /var/log/apache2/access.log combined
    </VirtualHost>

Если не настроена аутентификация через Kerberos, то для всех ресурсов должна использоваться аутентификация и авторизация через PAM, при этом будет использоваться пользовательская БД, прописанная в настройках ОС. Для выполнения аутентификации и авторизации через PAM должен быть установлен пакет `libapache2-mod-auth-pam` и выполнена следующая команда:

    # a2enmod auth_pam

Логин и пароль пользователя будут передаваться от пользователя к серверу в открытом виде с использованием метода аутентификации __Basic__.

Для корректного функционирования авторизации через PAM пользователю, от которого работает web-сервер (по умолчанию — `www-data`), необходимо выдать права на чтение информации из БД пользователей и сведений о мандатных метках:
    
    # usermod -a -G shadow www-data
    # setfacl -d -m u:www-data:r /etc/parsec/macdb
    # setfacl -R -m u:www-data:r /etc/parsec/macdb
    # setfacl -m u:www-data:rx /etc/parsec/macdb

Если установлен модуль web-сервера Apache2 `auth_kerb` из пакета `libapache2-mod-auth-kerb` для аутентификации через Kerberos, нужно отключить его использование при помощи команды:
    
    # a2dismod auth_kerb

После окончания правки конфигурационных файлов необходимо перезапустить
сервер командой:

    # /etc/init.d/apache2 restart

----

__ДОКУМЕНТАЦИЯ:__ ОПЕРАЦИОННАЯ СИСТЕМА СПЕЦИАЛЬНОГО НАЗНАЧЕНИЯ «ASTRA LINUX SPECIAL EDITION». Руководство администратора. Часть 1 (РУСБ.10015-01 95 01-1) Раздел 12. ЗАЩИЩЕННЫЙ КОМПЛЕКС ПРОГРАММ ГИПЕРТЕКСТОВОЙ ОБРАБОТКИ ДАННЫХ.